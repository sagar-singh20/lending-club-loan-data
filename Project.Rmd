---
title: "Project"
author: "Sarang Pande"
date: "4/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries

```{r}
library(dplyr)
library(leaps)
library(tidyverse)
library(cowplot)
library(GGally)
library(Metrics)
```

# Data Gathering

```{r}
loan_data <- read.csv('loan.csv')
```

# Data Preprocessing

Lets extract all the borrower characteristic available before he applies for a loan. 

```{r}
column_vector <- c('loan_amnt', 'term', 'int_rate', 'emp_length', 'home_ownership', 'annual_inc', 'verification_status', 'purpose', 'addr_state', 'dti', 'open_acc', 'total_acc', 'grade', 'sub_grade', 'delinq_2yrs', 'inq_last_6mths', 'pub_rec', 'revol_bal', 'revol_util')
loan_data_filtered <- loan_data %>% select(all_of(column_vector))
```

Lets drop rows missing any of the data.

```{r}
loan_data_filtered <- drop_na(loan_data_filtered)
```

```{r}
summary(loan_data_filtered)
```

# Data Transformation

```{r}
table(loan_data_filtered$emp_length)
loan_data_filtered <- loan_data_filtered %>% filter(emp_length != 'n/a')
```

```{r}
loan_data_filtered <- loan_data_filtered %>% mutate(years = ifelse(emp_length ==  "< 1 year", 0, ifelse(emp_length ==  "1 year", 1, ifelse(emp_length ==  "2 years", 2, ifelse(emp_length ==  "3 years", 3, ifelse(emp_length ==  "4 years", 4, ifelse(emp_length ==  "5 years", 5, ifelse(emp_length ==  "6 years", 6, ifelse(emp_length ==  "7 years", 7, ifelse(emp_length ==  "8 years", 8, ifelse(emp_length ==  "9 years", 9, 10)))))))))))
loan_data_filtered <- loan_data_filtered %>% select(-emp_length)
loan_data_filtered$years <- as.factor(loan_data_filtered$years)
```

```{r}
table(loan_data_filtered$home_ownership)
loan_data_filtered$home_ownership <- as.character(loan_data_filtered$home_ownership)
loan_data_filtered <- loan_data_filtered %>% filter(home_ownership %in% c('MORTGAGE', 'OWN', 'RENT'))
loan_data_filtered$home_ownership <- as.factor(loan_data_filtered$home_ownership)
```

```{r}
boxplot(loan_data_filtered$annual_inc)
hist(loan_data_filtered$annual_inc, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$annual_inc, plot = FALSE)$out
loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$annual_inc %in% outliers),]
```

```{r}
class(loan_data_filtered$purpose)
loan_data_filtered$purpose <- as.character(loan_data_filtered$purpose)
```

```{r}
table(loan_data_filtered$purpose)
loan_data_filtered <- loan_data_filtered %>% mutate(purpose = ifelse(purpose %in% c('educational', 'house', 'vacation', 'wedding', 'renewable_energy', 'moving'), 'other', purpose))
loan_data_filtered$purpose <- as.factor(loan_data_filtered$purpose)
```

```{r}
boxplot(loan_data_filtered$dti)
hist(loan_data_filtered$dti, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$dti, plot = FALSE)$out
loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$dti %in% outliers),]
loan_data_filtered <- loan_data_filtered %>% filter(dti >= 0)
```

```{r}
boxplot(loan_data_filtered$open_acc)
hist(loan_data_filtered$open_acc, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$open_acc, plot = FALSE)$out
#loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$open_acc %in% outliers),]
```

```{r}
boxplot(loan_data_filtered$total_acc)
hist(loan_data_filtered$total_acc, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$total_acc, plot = FALSE)$out
#loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$total_acc %in% outliers),]
```

```{r}
boxplot(loan_data_filtered$revol_bal)
hist(loan_data_filtered$revol_bal, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$revol_bal, plot = FALSE)$out
#loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$revol_bal %in% outliers),]
```

```{r}
boxplot(loan_data_filtered$revol_util)
hist(loan_data_filtered$revol_util, breaks = 100)
```

```{r}
outliers <- boxplot(loan_data_filtered$revol_util, plot = FALSE)$out
loan_data_filtered <- loan_data_filtered[-which(loan_data_filtered$revol_util %in% outliers),]
```

```{r}
loan_data_filtered$pub_rec <- as.factor(loan_data_filtered$pub_rec)
loan_data_filtered$inq_last_6mths <- as.factor(loan_data_filtered$inq_last_6mths)
loan_data_filtered$delinq_2yrs <- as.factor(loan_data_filtered$delinq_2yrs)
```

# Check for problems

```{r}
my_plots <- lapply(names(loan_data_filtered), function(var_x){
  p <-ggplot(loan_data_filtered) + aes_string(var_x)
  if(is.numeric(loan_data_filtered[[var_x]])) {
    p <- p + geom_histogram(bins = 10)
  } else {
    p <- p + geom_bar()
  } 
})

plot_grid(plotlist = my_plots)
```

```{r}
lm.fit <- lm(int_rate ~ ., data = loan_data_filtered)
```

```{r}
table(loan_data_filtered$purpose)
```

```{r}
minMaxNormalize <- function(x) {
return ((x - min(x)) / (max(x) - min(x)))
}

standardScalarNormalize <- function(x) {
return ((x - mean(x)) / sd(x))
}
```